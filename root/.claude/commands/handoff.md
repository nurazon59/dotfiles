# 引き継ぎドキュメント生成コマンド

セッション切れ間際でも確実に引き継ぎ情報を残すためのコマンド。
**subagent不使用・即座実行**で `zzz/handoff-{timestamp}.md` を生成する。

## 引数

- `$ARGUMENTS`: 追加メモ（省略可能）
  - 例: `/handoff 明日の朝までに確認お願いします`

## 重要な制約

- **Task tool / subagent 使用禁止**（セッション切れ対策）
- **時間のかかる分析は行わない**
- **ファイル読み込みは最小限**
- **即座に書き出すことを最優先**

## 実行手順

### Step 1: 出力ファイル準備

1. タイムスタンプ取得: `date +%Y%m%d-%H%M`
2. 出力先: `zzz/handoff-{timestamp}.md`
3. zzzディレクトリがなければ作成

### Step 2: 最重要情報を即座に書き出し（Claude自身が直接記述）

以下の情報をClaudeが**自分の記憶から直接**書き出す（ツール不要）:

| セクション | 内容 |
|-----------|------|
| ユーザーの要求・背景 | 何を達成しようとしているか、最終目標は何か |
| 会話履歴の要約 | どういう会話をして、どういう経緯でここに至ったか |
| 作業内容と進捗 | 何をやって、どこまで終わったか、何が残っているか |
| 設計判断・理由 | なぜこの実装を選んだか、検討した代替案は何か |
| 次にやるべきこと | 優先順位付きで具体的なタスクリスト |
| 懸念事項・ブロッカー | 注意すべき点、未解決の問題、確認待ち事項 |

### Step 3: 補足情報を軽量コマンドで取得

以下のコマンドを**並列実行**して情報収集:

```bash
# ブランチ情報
git branch --show-current

# 変更状態
git status -s

# 直近コミット
git log --oneline -5

# PR情報（あれば）
gh pr view --json number,title,url,state 2>/dev/null || echo "PRなし"
```

### Step 4: ドキュメント出力

収集した情報を以下のフォーマットで出力:

---

## 出力フォーマット

```markdown
# 引き継ぎドキュメント

**生成日時**: {YYYY-MM-DD HH:MM}
**ブランチ**: `{ブランチ名}`

---

## 1. ユーザーの要求・背景

{ユーザーが最終的に何を達成しようとしているか}
{このタスクの背景・目的}

---

## 2. 会話履歴の要約

{セッション開始からの主要なやり取り}
{重要な決定事項や方針変更}
{ユーザーからのフィードバック}

---

## 3. 作業内容と進捗

### 完了したこと
- {完了タスク1}
- {完了タスク2}

### 進行中
- {現在作業中のタスク} ← **ここから再開**

### 未着手
- {まだ手をつけていないタスク}

---

## 4. 設計判断・理由

### 採用した方針
{選択した実装方針とその理由}

### 検討した代替案
{検討したが採用しなかった案とその理由}

### 技術的な決定
{使用したライブラリ、パターン、アーキテクチャの選択理由}

---

## 5. 次にやるべきこと

### 優先度: 高
1. {最優先タスク}
2. {次に優先タスク}

### 優先度: 中
- {中優先度タスク}

### 優先度: 低（余裕があれば）
- {低優先度タスク}

---

## 6. 懸念事項・ブロッカー

### ブロッカー（作業を止めているもの）
- {なければ「なし」}

### 懸念事項（注意が必要なもの）
- {技術的懸念、レビュー指摘、等}

### 確認待ち事項
- {誰かの確認/判断が必要な項目}

---

## 7. ブランチ・PR情報

| 項目 | 値 |
|------|-----|
| ブランチ | `{ブランチ名}` |
| PR | {PRがあれば番号とURL、なければ「未作成」} |
| 状態 | {Open/Draft/未作成} |

### 変更ファイル
```
{git status -s の出力}
```

### 直近コミット
```
{git log --oneline -5 の出力}
```

---

## 8. クイックスタート

後任者が作業を再開するための最短手順:

1. `git checkout {ブランチ名}`
2. `git pull origin {ブランチ名}`
3. **{最初にやるべきタスク}** から再開
4. 懸念事項の「{最重要懸念}」に注意

---

> **追加メモ**: {$ARGUMENTSがあればここに表示}

---

*このドキュメントは `/handoff` コマンドで自動生成されました*
```

---

## 使用例

```bash
# 基本使用（引数なし）
/handoff

# メモ付き
/handoff 明日レビューお願いします

# 緊急引き継ぎ
/handoff 緊急対応のため中断。CI修正が最優先
```

---

## 実行フロー図

```
/handoff 実行
    ↓
即座にzzz/handoff-{timestamp}.md作成開始
    ↓
Claude自身が知っている情報を直接書き出し
（会話履歴、ユーザー意図、設計判断、次タスク）
    ↓
並列でgit/gh情報取得（軽量コマンドのみ）
    ↓
ファイル出力完了
    ↓
「引き継ぎドキュメントを生成しました: zzz/handoff-XXXXXXXX-XXXX.md」
```
